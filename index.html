<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitflow Pro | Master Edition</title>
    <style>
        :root { --primary: #1a5276; --accent: #2ecc71; --bg: #f0f3f4; --whatsapp: #25d366; --protein: #9b59b6; --burn: #e67e22; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; }
        .container { max-width: 450px; margin: auto; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h2 { font-size: 1rem; color: var(--primary); margin-top: 0; text-transform: uppercase; border-left: 4px solid var(--accent); padding-left: 10px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-add { background: var(--accent); }
        .search-results { max-height: 200px; overflow-y: auto; border: 1px solid #eee; display: none; margin-bottom: 10px; border-radius: 10px; }
        .food-opt { padding: 12px; border-bottom: 1px solid #f9f9f9; cursor: pointer; font-size: 0.9rem; }
        .water-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        .glass { background: #e8f6ff; border: 2px solid #3498db; border-radius: 8px; height: 45px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .glass.full { background: #3498db; color: white; }
        .stat-line { display: flex; justify-content: space-between; font-weight: bold; font-size: 0.9rem; margin-top: 5px; }
        .budget-box { text-align: center; padding: 15px; background: #e8f4fd; border-radius: 10px; margin-bottom: 15px; }
        #setupScreen, #mainApp { display: none; }
    </style>
</head>
<body onload="initApp()">

<div id="setupScreen" class="container">
    <div class="card" style="text-align: center;">
        <h1 style="color: var(--primary);">Fitflow Pro Setup</h1>
        <input type="text" id="userName" placeholder="Your Name">
        <input type="number" id="userHeight" placeholder="Height (cm)">
        <input type="number" id="userWeight" placeholder="Current Weight (kg)">
        <input type="number" id="userAge" placeholder="Age (e.g. 41)">
        <select id="userGender">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>
        <button onclick="saveProfile()" class="btn-add">Save & Calculate Budget</button>
    </div>
</div>

<div id="mainApp">
    <div class="header">
        <h1 id="greet" style="margin:0; font-size: 1.4rem;">Fitflow Pro</h1>
        <span id="targetDisplay" style="font-size: 0.8rem; opacity: 0.9;"></span>
    </div>

    <div class="container">
        <div class="card">
            <h2>Calorie Manager</h2>
            <div class="budget-box">
                <div style="font-size: 0.8rem; color: #555;">REMAINING BUDGET</div>
                <div id="netCalories" style="font-size: 2rem; color: var(--primary);">0</div>
                <div style="font-size: 0.8rem;">Target: <span id="budgetDisplay">0</span> | Intake: <span id="intakeDisplay">0</span> | Burn: <span id="burnDisplay">0</span></div>
            </div>
            <div id="tipDisplay" style="font-style: italic; font-size: 0.85rem; text-align: center; color: #666;"></div>
        </div>

        <div class="card">
            <h2>Activity & Sleep</h2>
            <input type="number" id="steps" placeholder="Steps Today" oninput="updateVitals()">
            <input type="number" id="sleep" placeholder="Sleep Hours" oninput="updateVitals()">
        </div>

        <div class="card">
            <h2>Hydration (250ml)</h2>
            <div class="water-grid" id="waterGrid"></div>
            <p style="text-align:center; font-weight:bold;">Total: <span id="totalWater">0</span>L</p>
        </div>

        <div class="card">
            <h2>South Indian Nutrition</h2>
            <input type="text" id="search" placeholder="Search Food..." oninput="searchFood()">
            <div id="results" class="search-results"></div>
            <div id="mealList"></div>
            <div class="stat-line" style="color:var(--protein); margin-top:10px;"><span>Total Protein:</span> <span id="totalPro">0</span> g</div>
        </div>

        <button style="background: var(--whatsapp);" onclick="shareWhatsApp()">Share Report to Coach</button>
        <button onclick="resetDay()" style="background:#e74c3c; margin-top:10px; font-size:0.8rem;">Clear Daily Logs</button>
    </div>
</div>

<script>
    const foodDb = [
        { name: "Idli (2) + Sambar", cal: 180, pro: 6 }, { name: "Masala Dosa", cal: 350, pro: 6 },
        { name: "Curd Rice", cal: 190, pro: 5 }, { name: "Veg Meals (Thali)", cal: 550, pro: 14 },
        { name: "Chicken Curry", cal: 250, pro: 25 }, { name: "Whey Protein", cal: 120, pro: 25 },
        { name: "Chapati (1)", cal: 85, pro: 3 }, { name: "Filter Coffee", cal: 90, pro: 2 }
    ];

    const coachTips = [
        "Drink water 30 mins before meals to improve digestion.",
        "Protein at breakfast reduces cravings for the whole day.",
        "10,000 steps is great, but 7,000 steps consistently is better.",
        "Sleep is where the fat burn actually happens. Aim for 7h+.",
        "South Indian tip: Add more fiber with a side of Poriyal."
    ];

    let waterState = [0,0,0,0,0,0,0,0];

    function initApp() {
        const profile = localStorage.getItem('ff_profile');
        if (!profile) { document.getElementById('setupScreen').style.display = 'block'; } 
        else { document.getElementById('mainApp').style.display = 'block'; loadData(); }
    }

    function saveProfile() {
        const name = document.getElementById('userName').value;
        const h = document.getElementById('userHeight').value;
        const w = document.getElementById('userWeight').value;
        const a = document.getElementById('userAge').value;
        const g = document.getElementById('userGender').value;
        if (!name || !h || !w || !a) return alert("Fill all fields");

        // Mifflin-St Jeor Formula for BMR
        let bmr = (10 * w) + (6.25 * h) - (5 * a);
        bmr = (g === 'male') ? bmr + 5 : bmr - 161;
        const targetWeight = (23 * ((h/100)*(h/100))).toFixed(1);

        localStorage.setItem('ff_profile', JSON.stringify({ name, h, w, a, g, bmr: Math.round(bmr), target: targetWeight }));
        location.reload();
    }

    function loadData() {
        const p = JSON.parse(localStorage.getItem('ff_profile'));
        document.getElementById('greet').innerText = "Fitflow Pro: " + p.name;
        document.getElementById('targetDisplay').innerText = `Goal: ${p.target}kg | BMR: ${p.bmr} kcal`;
        document.getElementById('budgetDisplay').innerText = p.bmr;
        document.getElementById('tipDisplay').innerText = "Coach Tip: " + coachTips[Math.floor(Math.random()*coachTips.length)];
        
        document.getElementById('steps').value = localStorage.getItem('ff_steps') || '';
        document.getElementById('sleep').value = localStorage.getItem('ff_sleep') || '';
        
        let w = localStorage.getItem('ff_water'); if(w) waterState = JSON.parse(w);
        setupWater(); renderMeals();
    }

    function updateVitals() {
        const s = document.getElementById('steps').value || 0;
        localStorage.setItem('ff_steps', s);
        localStorage.setItem('ff_sleep', document.getElementById('sleep').value);
        document.getElementById('burnDisplay').innerText = (s * 0.04).toFixed(0);
        updateNet();
    }

    function searchFood() {
        const q = document.getElementById('search').value.toLowerCase();
        const r = document.getElementById('results');
        if(q.length < 1) { r.style.display='none'; return; }
        const fil = foodDb.filter(f => f.name.toLowerCase().includes(q));
        r.innerHTML = ''; r.style.display = 'block';
        fil.forEach(f => {
            const d = document.createElement('div'); d.className = 'food-opt';
            d.innerHTML = `<strong>${f.name}</strong> - ${f.cal}kcal / ${f.pro}g P`;
            d.onclick = () => { addMeal(f); r.style.display='none'; document.getElementById('search').value=''; };
            r.appendChild(d);
        });
    }

    function addMeal(f) {
        let m = JSON.parse(localStorage.getItem('ff_meals') || '[]');
        m.push(f); localStorage.setItem('ff_meals', JSON.stringify(m));
        renderMeals();
    }

    function renderMeals() {
        let m = JSON.parse(localStorage.getItem('ff_meals') || '[]');
        let list = document.getElementById('mealList'); list.innerHTML = '';
        let tc = 0, tp = 0;
        m.forEach(i => { tc += i.cal; tp += i.pro; list.innerHTML += `<div class="meal-item"><span>${i.name}</span><span>${i.cal}k / ${i.pro}g</span></div>`; });
        document.getElementById('intakeDisplay').innerText = tc;
        document.getElementById('totalPro').innerText = tp;
        updateNet();
    }

    function updateNet() {
        const bmr = parseInt(document.getElementById('budgetDisplay').innerText);
        const intake = parseInt(document.getElementById('intakeDisplay').innerText);
        const burn = parseInt(document.getElementById('burnDisplay').innerText);
        const net = bmr - intake + burn;
        const display = document.getElementById('netCalories');
        display.innerText = net;
        display.style.color = (net < 0) ? "#e74c3c" : "var(--primary)";
    }

    function setupWater() {
        const grid = document.getElementById('waterGrid'); grid.innerHTML = '';
        waterState.forEach((s, i) => {
            let d = document.createElement('div'); d.className = s ? 'glass full' : 'glass';
            d.innerHTML = 'üíß'; d.onclick = () => { waterState[i] = waterState[i] ? 0 : 1; localStorage.setItem('ff_water', JSON.stringify(waterState)); setupWater(); };
            grid.appendChild(d);
        });
        document.getElementById('totalWater').innerText = (waterState.filter(s => s).length * 0.25).toFixed(2);
    }

    function shareWhatsApp() {
        const p = JSON.parse(localStorage.getItem('ff_profile'));
        const text = `*Fitflow Pro: ${p.name} Report*%0AüèÉ Steps: ${document.getElementById('steps').value}%0Aüçé Intake: ${document.getElementById('intakeDisplay').innerText} / Budget: ${p.bmr}%0Aüí™ Protein: ${document.getElementById('totalPro').innerText}g%0Aüî• Net Cal: ${document.getElementById('netCalories').innerText}`;
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function resetDay() { if(confirm("Reset logs?")) { localStorage.removeItem('ff_water'); localStorage.removeItem('ff_meals'); localStorage.removeItem('ff_steps'); localStorage.removeItem('ff_sleep'); location.reload(); } }
</script>
</body>
</html>
