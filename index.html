<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitflow Pro | Structured Dashboard</title>
    <style>
        :root { --primary: #1a5276; --accent: #2ecc71; --bg: #f0f3f4; --whatsapp: #25d366; --protein: #9b59b6; --burn: #e67e22; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 60px; }
        .header { background: var(--primary); color: white; padding: 25px 20px; text-align: center; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; position: relative; }
        .container { max-width: 450px; margin: auto; padding: 15px; }
        
        /* Section Styling */
        .section-label { font-size: 0.75rem; font-weight: bold; color: #7f8c8d; text-transform: uppercase; letter-spacing: 1px; margin: 20px 0 10px 10px; }
        .card { background: white; border-radius: 18px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); }
        
        /* Scorecard */
        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .score-box { text-align: center; padding: 15px; border-radius: 15px; background: #fff; border: 1px solid #eee; }
        .big-num { font-size: 1.8rem; font-weight: bold; display: block; }
        .small-lbl { font-size: 0.65rem; color: #7f8c8d; text-transform: uppercase; font-weight: bold; }
        
        /* Inputs */
        input, select, button { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #eee; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .water-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .glass { background: #e8f6ff; border-radius: 10px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; border: 1px solid #d4e9f7; }
        .glass.full { background: #3498db; color: white; }
        
        .search-results { max-height: 180px; overflow-y: auto; background: #fff; border: 1px solid #eee; border-radius: 10px; display: none; }
        .food-opt { padding: 12px; border-bottom: 1px solid #f9f9f9; cursor: pointer; font-size: 0.85rem; }
        
        #setupScreen, #mainApp { display: none; }
        .goal-icon { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; cursor: pointer; }
    </style>
</head>
<body onload="initApp()">

<div id="setupScreen" class="container">
    <div class="card" style="text-align: center; margin-top: 50px;">
        <h1 style="color: var(--primary);">Fitflow Pro Setup</h1>
        <input type="text" id="userName" placeholder="Your Name">
        <input type="number" id="userHeight" placeholder="Height (cm)">
        <input type="number" id="userWeight" placeholder="Current Weight (kg)">
        <input type="number" id="userAge" placeholder="Age">
        <select id="userGender">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>
        <button onclick="saveProfile()" style="background: var(--accent);">Initialize My Flow</button>
    </div>
</div>

<div id="mainApp">
    <div class="header">
        <div class="goal-icon" onclick="alert('BMI Status: Healthy\nTarget: ' + JSON.parse(localStorage.getItem('ff_profile')).target + 'kg')">üìä</div>
        <h1 id="greet" style="margin:0; font-size: 1.3rem;">Fitflow Pro</h1>
        <div id="targetDisplay" style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;"></div>
    </div>

    <div class="container">
        
        <div class="section-label">Zone 1: Metabolic Scorecard</div>
        <div class="score-grid">
            <div class="score-box" style="border-top: 4px solid var(--primary);">
                <span class="small-lbl">Calorie Budget</span>
                <span id="netCalories" class="big-num">0</span>
                <span style="font-size: 0.6rem; color: #999;">Remaining</span>
            </div>
            <div class="score-box" style="border-top: 4px solid var(--protein);">
                <span class="small-lbl">Protein Goal</span>
                <span id="proteinDisplay" class="big-num" style="color: var(--protein);">0</span>
                <span id="proteinGoalText" style="font-size: 0.6rem; color: #999;">Goal: 0g</span>
            </div>
        </div>

        <div class="section-label">Zone 2: Movement & Recovery</div>
        <div class="card">
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;"><span class="small-lbl">Steps</span><input type="number" id="steps" oninput="updateVitals()"></div>
                <div style="flex: 1;"><span class="small-lbl">Sleep (h)</span><input type="number" id="sleep" oninput="updateVitals()"></div>
            </div>
            <div style="text-align:center; color:var(--burn); font-weight:bold; font-size:0.8rem; margin-top:5px;">Est. Burn: <span id="burnDisplay">0</span> kcal</div>
            
            <h2 style="margin-top: 20px; font-size: 0.9rem;">üíß Hydration <span style="font-size: 0.7rem; font-weight: normal;">(Total: <span id="totalWater">0</span>L)</span></h2>
            <div class="water-grid" id="waterGrid"></div>
        </div>

        <div class="section-label">Zone 3: Fuel (South Indian Database)</div>
        <div class="card">
            <input type="text" id="search" placeholder="Search Food..." oninput="searchFood()">
            <div id="results" class="search-results"></div>
            <div id="mealList" style="margin-top: 10px;"></div>
        </div>

        <button style="background: var(--whatsapp); border-radius: 15px;" onclick="shareWhatsApp()">üì± Share Summary to Coach</button>
        <button onclick="resetDay()" style="background: none; color: #e74c3c; font-size: 0.75rem; border: none; margin-top: 10px; text-decoration: underline;">Reset All Daily Logs</button>

    </div>
</div>

<script>
    const foodDb = [
        { name: "Idli (2) + Sambar", cal: 180, pro: 8 }, { name: "Masala Dosa", cal: 350, pro: 6 },
        { name: "Curd Rice", cal: 190, pro: 5 }, { name: "Chicken Curry", cal: 250, pro: 25 },
        { name: "Whey Protein", cal: 120, pro: 25 }, { name: "Veg Thali", cal: 550, pro: 14 }
    ];

    let waterState = [0,0,0,0,0,0,0,0];

    function initApp() {
        const profile = localStorage.getItem('ff_profile');
        if (!profile) document.getElementById('setupScreen').style.display = 'block';
        else { document.getElementById('mainApp').style.display = 'block'; loadData(); }
    }

    function saveProfile() {
        const name = document.getElementById('userName').value, h = document.getElementById('userHeight').value, w = document.getElementById('userWeight').value, a = document.getElementById('userAge').value, g = document.getElementById('userGender').value;
        if (!name || !h || !w || !a) return alert("Missing fields");

        let bmr = (10 * w) + (6.25 * h) - (5 * a); bmr = (g === 'male') ? bmr + 5 : bmr - 161;
        const target = (23 * ((h/100)*(h/100))).toFixed(1);
        const pGoal = Math.round(target * 1.5); // Protein Goal: 1.5g per kg of target weight

        localStorage.setItem('ff_profile', JSON.stringify({ name, h, w, a, g, bmr: Math.round(bmr), target, pGoal }));
        location.reload();
    }

    function loadData() {
        const p = JSON.parse(localStorage.getItem('ff_profile'));
        document.getElementById('greet').innerText = "Fitflow Pro: " + p.name;
        document.getElementById('targetDisplay').innerText = `Target: ${p.target}kg | Budget: ${p.bmr} kcal`;
        document.getElementById('proteinGoalText').innerText = `Goal: ${p.pGoal}g`;
        document.getElementById('steps').value = localStorage.getItem('ff_steps') || '';
        document.getElementById('sleep').value = localStorage.getItem('ff_sleep') || '';
        
        let w = localStorage.getItem('ff_water'); if(w) waterState = JSON.parse(w);
        setupWater(); renderMeals();
    }

    function updateVitals() {
        const s = document.getElementById('steps').value || 0;
        localStorage.setItem('ff_steps', s);
        localStorage.setItem('ff_sleep', document.getElementById('sleep').value);
        document.getElementById('burnDisplay').innerText = (s * 0.04).toFixed(0);
        updateNet();
    }

    function searchFood() {
        const q = document.getElementById('search').value.toLowerCase();
        const r = document.getElementById('results');
        if(q.length < 1) { r.style.display='none'; return; }
        const fil = foodDb.filter(f => f.name.toLowerCase().includes(q));
        r.innerHTML = ''; r.style.display = 'block';
        fil.forEach(f => {
            const d = document.createElement('div'); d.className = 'food-opt';
            d.innerHTML = `<strong>${f.name}</strong> ‚Ä¢ ${f.pro}g Protein`;
            d.onclick = () => { addMeal(f); r.style.display='none'; document.getElementById('search').value=''; };
            r.appendChild(d);
        });
    }

    function addMeal(f) {
        let m = JSON.parse(localStorage.getItem('ff_meals') || '[]');
        m.push(f); localStorage.setItem('ff_meals', JSON.stringify(m));
        renderMeals();
    }

    function renderMeals() {
        let m = JSON.parse(localStorage.getItem('ff_meals') || '[]');
        let list = document.getElementById('mealList'); list.innerHTML = '';
        let tc = 0, tp = 0;
        m.forEach(i => { 
            tc += i.cal; tp += i.pro; 
            list.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #f9f9f9; padding:5px 0; font-size:0.8rem;"><span>${i.name}</span><span>${i.pro}g P</span></div>`; 
        });
        document.getElementById('proteinDisplay').innerText = tp;
        localStorage.setItem('temp_intake', tc);
        updateNet();
    }

    function updateNet() {
        const p = JSON.parse(localStorage.getItem('ff_profile'));
        const intake = parseInt(localStorage.getItem('temp_intake') || 0);
        const burn = parseInt(document.getElementById('burnDisplay').innerText);
        const net = p.bmr - intake + burn;
        const display = document.getElementById('netCalories');
        display.innerText = net;
        display.style.color = (net < 0) ? "#e74c3c" : "var(--primary)";
    }

    function setupWater() {
        const grid = document.getElementById('waterGrid'); grid.innerHTML = '';
        waterState.forEach((s, i) => {
            let d = document.createElement('div'); d.className = s ? 'glass full' : 'glass';
            d.innerHTML = 'üíß'; d.onclick = () => { waterState[i] = waterState[i] ? 0 : 1; localStorage.setItem('ff_water', JSON.stringify(waterState)); setupWater(); };
            grid.appendChild(d);
        });
        document.getElementById('totalWater').innerText = (waterState.filter(s => s).length * 0.25).toFixed(2);
    }

    function shareWhatsApp() {
        const p = JSON.parse(localStorage.getItem('ff_profile'));
        const text = `*Fitflow Pro Daily Summary*%0AüèÉ Steps: ${document.getElementById('steps').value}%0Aüí™ Protein: ${document.getElementById('proteinDisplay').innerText} / ${p.pGoal}g%0Aüçé Net Cal: ${document.getElementById('netCalories').innerText}`;
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function resetDay() { if(confirm("Clear logs?")) { localStorage.removeItem('ff_water'); localStorage.removeItem('ff_meals'); localStorage.removeItem('ff_steps'); localStorage.removeItem('ff_sleep'); location.reload(); } }
</script>
</body>
</html>
